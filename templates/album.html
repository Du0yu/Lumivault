<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Lumivault</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="navbar">
        <div class="navbar-inner">
            <a href="{{ url_for('nav') }}" class="navbar-title" style="text-decoration:none;color:inherit;">Lumivault</a>
            <span class="navbar-desc">Media Library</span>
            <a href="{{ url_for('nav') }}" class="navbar-category-btn">åˆ†ç±»</a>
            <a href="{{ url_for('config') }}" class="navbar-btn">è®¾ç½®</a>
            <button class="theme-toggle" id="themeToggle" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
            <div class="navbar-menu-icon" id="navbarMenuIcon" title="èœå•" style="display:none;">
                &#9776;
            </div>
        </div>
    </div>
    <!-- ä¾§è¾¹èœå• -->
    <div class="side-menu" id="sideMenu">
        <button class="side-menu-close" id="sideMenuClose" title="å…³é—­èœå•">&times;</button>
        <a href="{{ url_for('nav') }}">åˆ†ç±»</a>
        <a href="{{ url_for('config') }}">è®¾ç½®</a>
    </div>
    <div class="container">
    {% for category, files in categories.items() %}
    <div class="category">
        <h2>{{ category }}</h2>
        
        <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
        <div class="tab-container">
            {% if files.images %}
            <button class="tab-btn active" data-tab="images-{{ loop.index }}">å›¾ç‰‡ ({{ files.images|length }})</button>
            {% endif %}
            {% if files.videos %}
            <button class="tab-btn {% if not files.images %}active{% endif %}" data-tab="videos-{{ loop.index }}">è§†é¢‘ ({{ files.videos|length }})</button>
            {% endif %}
        </div>
        
        <!-- å›¾ç‰‡æ ‡ç­¾é¡µå†…å®¹ -->
        {% if files.images %}
        <div class="tab-content active" id="images-{{ loop.index }}">
            <div class="media-list" id="mediaList-img-{{ loop.index }}">
                {% for image in files.images %}
                {% set ratio_class = "ratio-" + image.ratio %}
                <div class="media-item {{ ratio_class }}" data-category="{{ category }}" data-index="{{ loop.index0 }}">
                    <a href="{{ url_for('media', category=category, filename=image.filename) }}" target="_blank" class="image-link">
                        <div class="img-wrapper">
                            <img src="{{ url_for('media', category=category, filename=image.filename) }}" alt="" class="zoomable-image"
                                 data-category="{{ category }}" data-index="{{ loop.index0 }}">
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- è§†é¢‘æ ‡ç­¾é¡µå†…å®¹ -->
        {% if files.videos %}
        <div class="tab-content {% if not files.images %}active{% endif %}" id="videos-{{ loop.index }}">
            <div class="media-list" id="mediaList-video-{{ loop.index }}">
                {% for video in files.videos %}
                <div class="media-item ratio-16-9" data-category="{{ category }}" data-index="{{ loop.index0 }}">
                    <a href="{{ url_for('video_player', category=category, filename=video) }}" style="text-decoration:none;width:100%;height:100%;">
                        <div class="img-wrapper">
                            <div class="video-cover">
                                {# ä¼˜å…ˆç”¨è‡ªåŠ¨ç”Ÿæˆçš„å°é¢ #}
                                {% set thumb_key = category ~ '/' ~ video %}
                                <video
                                    width="100%"
                                    height="100%"
                                    poster="{% if video_thumbs[thumb_key] is defined %}{{ url_for('video_thumb', thumb_name=video_thumbs[thumb_key]) }}{% else %}https://img.icons8.com/ios-filled/100/cccccc/video.png{% endif %}"
                                    style="object-fit:cover;display:block;border-radius:8px;background:var(--bg-accent);"
                                    preload="none"
                                    muted
                                    playsinline
                                    ></video>
                                <span class="video-play-icon"></span>
                                <div class="video-title">{{ video }}</div>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    {% endfor %}
    </div>
    
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/album.js') }}"></script>
</body>
</html>
